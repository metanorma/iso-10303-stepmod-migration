# Auto-generated by Cimas: Do not edit it manually!
# See https://github.com/metanorma/cimas
name: ubuntu

on:
  push:
    branches: [ master ]
    tags:
      - '*'

jobs:
  rsync:
    name: rsync
    runs-on: ubuntu-latest
    # continue-on-error: ${{ matrix.experimental }}
    steps:
      - uses: actions/checkout@master
      - name: Install SSH key
        uses: shimataro/ssh-key-action@v2
        with:
          key: ${{ secrets.BOOST_CVS_SSH_PRIVATE_KEY }}
          name: id_rsa # optional
          known_hosts: ${{ secrets.BOOST_CONSEIL_KNOWN_HOSTS }}
      - name: Test SSH
        run: |
          ssh ronald@cvs.boost-lab.net 'ls ../'
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get -y install cvs-fast-export
      - name: rsync to stepmod-rsync/
        run: |
          rsync -avrPz -e ssh ronald@cvs.boost-lab.net:/stepmod/ stepmod-rsync/
      - name: Create fast-import file for Git
        run: |
          find stepmod-rsync -type f | cvs-fast-export -A author-map.txt > fast-import-file
      - name: Create directory and import into it
        run: |
          mkdir -p iso-10303-stepmod-cvs
          cd iso-10303-stepmod-cvs
          git fast-import < ../fast-import-file
